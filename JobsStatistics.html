## -*- coding: utf-8 -*-
<%inherit file="/module_base.html" />

<%def name="content()">
<script type="text/javascript">
$(function(){

var form_id = "#${module.instance_name}_plot_form";
$("#${module.instance_name}_toggle").click(function(){
    var boxes = $(form_id+" :checkbox");
    boxes.prop("checked", !boxes.is(":checked"));
});
function ${module.instance_name}_row_button(group) {
    $(form_id+" :hidden").remove();
    $(form_id).append('<input type="hidden" name="label" value="1" />');
    $("id^='${module.instance_name}_group_'").each(function(idx, element) {
        console.log("element.name");
    });
    return false;
};

});
</script>
<form id="${module.instance_name}_plot_form" method="get" action="$(hf.plotgenerator.getTimeseriesUrl()}" target="_blank">
 <table style="font: bold 0.7em sans-serif; width:800px; background-color: #ddd; border: 1px #999 solid;">
  <tr>
   <td>Start:</td>
   <td>
    <%
    import datetime
    backintime = run['time']-datetime.timedelta(days=2)
    %>
    <input name="date0" type="text" size="10" style="text-align:center;" value="${backintime.strftime('%Y-%m-%d')}" />
    <input name="time0" type="text" size="5" style="text-align:center;" value="${backintime.strftime('%H:%M')}" />
   </td>
   <td>End:</td>
   <td>
    <input name="date1" type="text" size="10" style="text-align:center;" value="${run['time'].strftime('%Y-%m-%d')}" />
    <input name="time1" type="text" size="5" style="text-align:center;" value="${run['time'].strftime('%H:%M')}" />
   </td>
   <td align="right">
    <input type="checkbox" name="renormalize" value="1" style="vertical-align: middle; margin: 0px;" />&nbsp;Show Trend plot
   </td>
  </tr>
 </table>
 <table class="TableData">
  <tr class="TableHeader">
   <td>Group</td>
   <td><input type="checkbox" id="${module.instance_name}_variable_0" value="total" checked="checked" />Total jobs</td>
   <td><input type="checkbox" id="${module.instance_name}_variable_1" value="running" checked="checked" />Running jobs</td>
   <td><input type="checkbox" id="${module.instance_name}_variable_2" value="ncpus" checked="checked" />Cores</td>
   <td><input type="checkbox" id="${module.instance_name}_variable_3" value="ratio10" checked="checked" />Jobs with wallratio &lt; 10%</td>
   <td>Plot jobs</td>
  </tr>
  <tr class="TableHeader">
   <td><input id="${module.instance_name}_toggle" type="button" value="Toggle Selection" onfocus="this.blur()" /></td>
   <td><button onfocus="this.blur()" group="total" onclick="${module.instance_name}_col_button('total')">Plot Col</button></td>
   <td><button onfocus="this.blur()" onclick="${module.instance_name}_col_button('running')">Plot Col</button></td>
   <td><button onfocus="this.blur()" onclick="${module.instance_name}_col_button('ncpus')">Plot Col</button></td>
   <td><button onfocus="this.blur()" onclick="${module.instance_name}_col_button('ratio10')">Plot Col</button></td>
   <td><button onfocus="this.blur()" onclick="${module.instance_name}_both_button()">Plot Selected</button></td>
  </tr>
% for i,group in enumerate(group_list):
 % if group['status'] >= 1.0:
  <tr class="ok">
 % elif group['status'] >= 0.5:
  <tr class="warning">
 % else:
  <tr class="critical">
 % endif
   <td style="padding-left: ${group['indentation']*15}px;"><input type="checkbox" id="${'%s_group_%i' %(module.instance_name, i)}" value="${group['group']}" checked="checked" />${group['group']}</td>
   <td>${group['total']}</td>
   <td>${group['running']}</td>
   <td>${group['ncpus']}</td>
   <td>${group['ratio10']}</td>
   <td><button onfocus="this.blur()" onclick="${module.instance_name}_row_button($info['group'])">Plot Row</button></td>
  </tr>
% endfor
 </table>
</form>
<br />

<input type="button" value="show/hide details" onfocus="this.blur()" onclick="$('#${module.instance_name}_details').slideToggle()" />
<div class="DetailedInfo" id="${module.instance_name}_details" style="display:none;">
% if len(dataset['details_group']) > 0:
 <p>Note: This table shows users of the group <strong>${dataset['details_group'] | h}</strong> only</p>
% endif
 <table class="TableDetails">
  <tr class="TableHeader">
   <td>User</td>
   <td>Total</td>
   <td>Running</td>
   <td>Cores</td>
   <td>Waiting</td>
   <td>Queued</td>
   <td>Eff. > 80%</td>
   <td>80% > Eff. > 30%</td>
   <td>30% > Eff. > 10%</td>
   <td>10% > Eff.</td>
  </tr>
% for info in info_list:
 % if info['status'] >= 1.0:
 <tr class="ok">
 % elif info['status'] >= 0.5:
 <tr class="warning">
 % else:
 <tr class="critical">
 % endif
  <td>${info['user'] | h}</td>
  <td>${info['total']}</td>
  <td>${info['running']}</td>
  <td>${info['ncpus']}</td>
  <td>${info['waiting']}</td>
  <td>${info['pending']}</td>
  <td>${info['ratio100']}</td>
  <td>${info['ratio80']}</td>
  <td>${info['ratio30']}</td>
  <td>${info['ratio10']}</td>
 </tr>
% endfor
 </table>
</div>
<br />
</%def>
