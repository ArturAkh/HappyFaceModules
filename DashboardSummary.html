## -*- coding: utf-8 -*-
<%inherit file="/module_base.html" />

<%def name="content()">
<script type="text/javascript">
function ${module.instance_name}_plot_metric(metric_path){
plot_window = window.open(metric_path, "_blank", "width=800,height=600");
plot_window.focus();
}

function ${module.instance_name}_plot_test(){
$('#${module.instance_name}_plot_form').submit();
}
</script>

<div id='${module.instance_name}_latest_data'>
	<h3>Note: Currently used view option for dashboard metrics: "${view_option}"</h3>
	<table class='TableData'>
	<tr>
	<td>Status color coding used here:</td>
	<td class='ok'>OK</td>
	<td class='warning'>Warning</td>
	<td class='critical'>Error</td>
	<td class='undefined'>Other</td>
	</tr>
	<tr class='TableHeader'>
		<td>Metric name</td>
		<td colspan=2>UTC time of latest status</td>
		<td colspan=2>Plot last 24 hours</td>
	</tr>
	<%!
	import time
	%>
	%for entry,plot in zip(latest_data,plots):
		<%
			plot_name = module.dataset['filename_plot'].getArchiveUrl().replace("dashboard_summary",plot["filename_plot"])
		%>
		%if entry['latest_status'] == 3:
			<tr class='critical'>
		%elif entry['latest_status'] == 4:
			<tr class='warning'>
		%elif entry['latest_status'] == 5:
			<tr class='ok'>
		%elif entry['latest_status'] == -1:
			<% continue %>
		%else:
			<tr class='undefined'>
		%endif
		<td>${entry['metric_name']}</td>
		<td colspan=2>${time.asctime(time.gmtime(entry['latest_time']))}</td>
   	<td colspan=2><center><input type="button" onclick = "${module.instance_name}_plot_metric('${plot_name}')"value="Plot Metric" name="Plot Metric" /></center></td>
		</tr>
	%endfor
	</table>
</div>

<form id="${module.instance_name}_plot_form" method="get" action="${hf.plotgenerator.getCustomPlotUrl()}" target="_blank">
<input name="module_instance_name" type="hidden" value="${module.instance_name}" />
<table class='TableData'>
<tr>
<td colplan=2><center>${module.instance_name}</td> 
<td colspan=2><center><input type="button" onclick = "${module.instance_name}_plot_test()"value="Plot Metric" name="Plot Metric" /></center></td></tr>
</table>
</form>
</%def>
